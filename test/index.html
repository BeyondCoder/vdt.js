<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>vdt template engine demo</title>
</head>
<body>
<script type="text/vdt" id="template">
    var a = 1, // this is a
        showInfo = function(index, name) {
            alert('Click ' + index + ' ' + name);
        }
    <div class="users">
        <input value={input} ev-change={add} ev-input={change}/> input: {input}
        <ul>
            {/* output users */}
            {users.map(function(user, index) {
                return <li className="user" id={user.id} ev-click={
                    // use es5's bind or underscore's bind to pass arguments
                    showInfo.bind(null, index, user.name)
                    // or closure
                    /*function() {
                        showInfo(index, user.name);
                    }*/
                }>{index}: {user.name}</li>
            })}
        </ul>
        {/* custom attributes */}
        <div attributes={{'data-a': a, input: input}} id={a} ev-dblclick={function() {console.log('Dblclick')}}>this is a({a})</div>
    </div>
</script>

<script type="text/javascript" src="../dist/vdt.js"></script>
<script type="text/javascript">
    var vdt = Vdt(document.getElementById('template').innerHTML),
        model = {
            users: [
                {name: 'John', id: '1'},
                {name: 'Javey', id: '2'},
                {name: 'Tom', id: '3'},
                {name: 'Sarah', id: '4'}
            ],
            input: '',

            add: function(e) {
                model.users.push({name: e.target.value, id: model.users.length});
                model.input = '';
                vdt.update();
            },

            change: function(e) {
                model.input = e.target.value;
                vdt.update();
            }
        };

    document.body.appendChild(vdt.render(model));

//    var input = document.getElementById('add');
//    input.addEventListener('input', function(e) {
//        data.input = e.target.value;
//        vdt.update(data);
//    });
//    input.addEventListener('change', function(e) {
//        data.users.push({name: e.target.value, id: data.users.length});
//        data.input = '';
//        vdt.update(data);
//    });

    // inherit
    var parent = function(obj,_Vdt, blocks) {
        _Vdt || (_Vdt = Vdt); var h = _Vdt.virtualDom.h;
        blocks || (blocks = {});
        var _blocks = {};
        var __blocks = {};
        console.log(this);
        with (obj || {}) {
            return h('div',null, [(_blocks.a = function(parent) {console.log('parent', this);return '1'}) && (__blocks.a = function(parent) {
                console.log(this);
                var self = this;
                return blocks.a ? blocks.a.call(this, function() {
                    console.log(self);
                    return _blocks.a.call(self, parent);
                }) : _blocks.a.call(this, parent);
            }) && __blocks.a.call(this)]);
//            return h('div',null, ['     ', (_blocks.a = function(parent) {return ['         ', h('div',null, ['aaa']), '         '];}) && (__blocks.a = function(parent) {
//                return blocks.a ? blocks.a(function() {
//                    return _blocks.a(parent);
//                }) : _blocks.a(parent);
//            }) && __blocks.a(), ' ']);
        }
    };
    var child = function(obj, _Vdt, blocks) {
        _Vdt || (_Vdt = Vdt); var h = _Vdt.virtualDom.h;
        blocks || (blocks = {});
        var _blocks = {};
        var __blocks = {};
        console.log(this);
        with (obj || {}) {
            return parent.call(this, obj, _Vdt, (_blocks.a = function(parent) {return [parent(), ['2', (_blocks.b = function(parent) {
                return 'b';
            }) && (__blocks.b = function(parent) {
                return blocks.b ? blocks.b(function() {
                    return _blocks.b(parent);
                }) : _blocks.b(parent);
            }) && __blocks.b()]];}) && (__blocks.a = function(parent) {
                console.log('child', this);
                var self = this;
                return blocks.a ? blocks.a.call(this, function() {
                    console.log(self);
                    return _blocks.a.call(self, parent);
                }) : _blocks.a.call(this, parent);
            }) && __blocks);
        }
    };
    var grandson = function(obj, _Vdt, blocks) {
        _Vdt || (_Vdt = Vdt); var h = _Vdt.virtualDom.h;
        blocks || (blocks = {});
        var _blocks = {};
        var __blocks = {};
        with (obj || {}) {
            return child(obj, _Vdt, (_blocks.a = function(parent) {return parent() + '3';}) && (__blocks.a = function(parent) {
                return blocks.a ? blocks.a(function() {
                    return _blocks.a(parent);
                }) : _blocks.a(parent);
            }) && __blocks);
        }
    };
    var grandson2 = function(obj, _Vdt, blocks) {
        _Vdt || (_Vdt = Vdt); var h = _Vdt.virtualDom.h;
        blocks || (blocks = {});
        var _blocks = {
            a: function(parent) {
                return parent() + '4';
            }
        };
        with (obj || {}) {
            return grandson(obj, _Vdt, _blocks);
        }
    };
    var inheritVdt = Vdt(child);
    document.body.appendChild(inheritVdt.render({a: 1}));
</script>
</body>
</html>